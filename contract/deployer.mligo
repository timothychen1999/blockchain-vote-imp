#import "main.mligo" "Tally"

module Deployer = struct
  
  type storage = unit
  type return = operation list * storage

  [@entry] let newvote (_: unit) (_ :unit) : return =
  let rsa = {
    n = 781790335999490179138962382702358651041473679694090529219242759331427030465947735193458993967014340194036876812224099703419451954255819393068387422872670001932691159172279225147575219188639094895452022686016552346323697772304836141360079993269430705568357933918752031087985634066897440841780629385890186126283423741403354884610541836540647658045468978318215059466096169591525491236656593911077313200179243514867464609241967080284972150694867408629543180350932174802471403462939181437494166501303819420550707808286768943913464067028484541933878666092312181892735654186068334138528618299916983530126248934325663658261022539992382508134931484372373197196364799695026063862025139274520261475570518620854044202139352695697530775480550074347721518003060087316794798123829411944631322342374321472047526040590635793604334380588532605493683919492472094589489193946266370736207182572954856274065763073571653863278159286506369646549330065897365288620093978514763158692488214975988608041448668653245580753538377532177921061624861889317704302959769541531713273846007802217604026150880902146574479799260963123538294774897991438383802117566855640167712269844641231924469319477751824586767047035572650221994906323839715676650033752191141869818242837n;
    v = 65537n;
  } in
  let used_ballots : nat big_set = Big_set.empty
  in
  let init_storage = {
    admin = Tezos.get_sender ();
    rsa_key  = rsa;
    va_key = rsa;
    vote_state = 1n;
    vote_count = 0n;
    status = Tally.Tally.uninitialized;
    n = 100n;
    r = 0n;
    y = 0n;
    result = 0n;
    used_ballot = used_ballots;
  } 
  in
  let op,_addr = 
    [%create_contract_of_file "./tally.tz"] None 0tez init_storage 
  in
  [op],()

end